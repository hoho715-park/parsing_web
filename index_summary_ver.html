<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JavaScript Code Parsing & Summary Web App</title>

<!-- JSZip -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- Meriyah Parser -->
<script src="https://unpkg.com/meriyah/dist/meriyah.umd.js"></script>

<style>
    body {
        background: #121212;
        color: #ffffff;
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1 {
        font-size: 32px;
        margin-bottom: 20px;
        color: #FFCC66;
        text-shadow: 0 0 8px rgba(255, 204, 102, 0.5);
    }

    .upload-box {
        width: 90%;
        max-width: 600px;
        border: 2px dashed #555;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        background: #1E1E1E;
        transition: 0.3s;
        cursor: pointer;
    }

    .upload-box:hover,
    .upload-box.dragover {
        border-color: #FFCC66;
        background: #2A2A2A;
        box-shadow: 0 0 12px rgba(255, 204, 102, 0.4);
    }

    input[type="file"] {
        display: none;
    }

    #summaryBox {
        width: 90%;
        max-width: 900px;
        background: #1E1E1E;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        line-height: 1.7;
        font-size: 16px;
    }

    #result, #astJsonBox {
        margin-top: 20px;
        width: 90%;
        max-width: 900px;
        height: 400px;
        background: #000;
        padding: 20px;
        border-radius: 10px;
        overflow-y: scroll;
        white-space: pre-wrap;
        font-size: 13px;
        font-family: Consolas, monospace;
        color: #00FF88;
    }

    #result::-webkit-scrollbar,
    #astJsonBox::-webkit-scrollbar {
        width: 8px;
    }
    #result::-webkit-scrollbar-track,
    #astJsonBox::-webkit-scrollbar-track {
        background: #202020;
        border-radius: 10px;
    }
    #result::-webkit-scrollbar-thumb,
    #astJsonBox::-webkit-scrollbar-thumb {
        background: #00ff88cc;
        border-radius: 10px;
    }
</style>
</head>

<body>

<h1>âš¡ JavaScript Code Parsing + AST Summary</h1>

<label for="zipUpload" id="dropZone" class="upload-box">
    <p>ğŸ“¦ ZIP íŒŒì¼ ì—…ë¡œë“œ ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</p>
    <p style="font-size: 13px; color:#aaa;">(JavaScript íŒŒì¼ í¬í•¨)</p>
    <button style="
        margin-top:10px;
        padding:10px 20px;
        border:none;
        border-radius:8px;
        background:#FFCC66;
        color:#000;
        cursor:pointer;
        font-weight:bold;
    ">íŒŒì¼ ì„ íƒ</button>
</label>

<input type="file" id="zipUpload" accept=".zip">

<div id="summaryBox">ğŸ“ AST ìš”ì•½ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<div id="result">AST ì „ì²´ JSONì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<!-- â˜… ì¶”ê°€: ast.json ì¶œë ¥ ë°•ìŠ¤ -->
<div id="astJsonBox" style="display:none;">ZIP ë‚´ë¶€ ast.json ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>


<script>
const dropZone = document.getElementById("dropZone");
const zipInput = document.getElementById("zipUpload");
const summaryBox = document.getElementById("summaryBox");
const resultBox = document.getElementById("result");
const astJsonBox = document.getElementById("astJsonBox");


/* ===========================
   DnD ê¸°ëŠ¥
=========================== */

dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.classList.add("dragover");
});

dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
});

dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    const file = e.dataTransfer.files[0];
    if (file) handleZipFile(file);
});

zipInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (file) handleZipFile(file);
});


/* ===========================
   ZIP ì²˜ë¦¬ + app.js + ast.json
=========================== */

async function handleZipFile(file) {
    summaryBox.textContent = "ğŸ“¦ ZIP íŒŒì¼ì„ ë¶„ì„ ì¤‘...";
    resultBox.textContent = "";
    astJsonBox.style.display = "none";

    const jszip = new JSZip();
    const zip = await jszip.loadAsync(file);

    let appJsFile = null;
    let astJsonFile = null;

    // â˜… app.jsì™€ ast.json ìë™ íƒì§€
    zip.forEach((path, entry) => {
        if (path.endsWith("app.js")) {
            appJsFile = entry;
        }
        if (path.endsWith("ast.json")) {
            astJsonFile = entry;
        }
    });

    if (!appJsFile) {
        summaryBox.textContent = "âŒ ZIP ì•ˆì— app.js íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤!";
        return;
    }

    // -------------------------
    // 1) app.js íŒŒì‹±
    // -------------------------
    const code = await appJsFile.async("string");

    const ast = meriyah.parse(code, {
        module: true,
        next: true,
        loc: true
    });

    resultBox.textContent = `ğŸ“„ íŒŒì¼: ${appJsFile.name}\n` +
        JSON.stringify(ast, null, 2);


    const summary = analyzeAST(ast);

    summaryBox.innerHTML = `
        <h3>ğŸ“Š AST ìš”ì•½ ë¶„ì„ ê²°ê³¼</h3>
        âœ” í•¨ìˆ˜ ì„ ì–¸(FunctionDeclaration): <b>${summary.functions}</b><br>
        âœ” ë³€ìˆ˜ ì„ ì–¸(VariableDeclarator): <b>${summary.variables}</b><br>
        âœ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬(addEventListener): <b>${summary.eventListeners}</b><br>
        âœ” íŒŒì¼ ì´ë¦„: <b>${appJsFile.name}</b><br>
        âœ” ë¶„ì„ ì™„ë£Œ ì‹œê°„: <b>${new Date().toLocaleTimeString()}</b>
    `;

    // -------------------------
    // â˜… 2) ZIP ì•ˆì— ast.jsonì´ ìˆìœ¼ë©´ í™”ë©´ ì¶œë ¥
    // -------------------------
    if (astJsonFile) {
        const jsonText = await astJsonFile.async("string");

        try {
            const parsedJson = JSON.parse(jsonText);

            astJsonBox.style.display = "block";
            astJsonBox.textContent = `ğŸ“„ ZIP ë‚´ë¶€ ast.json íŒŒì¼:\n\n` +
                JSON.stringify(parsedJson, null, 2);

        } catch (e) {
            astJsonBox.style.display = "block";
            astJsonBox.textContent = "âš  ast.json íŒŒì‹± ì‹¤íŒ¨ (JSON í˜•ì‹ ì˜¤ë¥˜)";
        }
    }
}


/* ===========================
   AST ë¶„ì„
=========================== */

function analyzeAST(ast) {
    let functions = 0;
    let variables = 0;
    let eventListeners = 0;

    function walk(node) {
        if (!node || typeof node !== "object") return;

        if (node.type === "FunctionDeclaration") functions++;
        if (node.type === "VariableDeclarator") variables++;

        if (
            node.type === "CallExpression" &&
            node.callee &&
            node.callee.property &&
            node.callee.property.name === "addEventListener"
        ) {
            eventListeners++;
        }

        for (let key in node) walk(node[key]);
    }

    walk(ast);
    return { functions, variables, eventListeners };
}

</script>

</body>
</html>
